<link rel="manifest" href="manifest.json" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="application-name" content="Summer Todo" />
<meta name="apple-mobile-web-app-title" content="Summer Todo" />
<meta name="msapplication-starturl" content="/index.html" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>
<link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.css"> 
<style>
	i {
	    cursor: pointer;
	}
	ul {
	list-style: none;
	}
	#list{
		margin-top:20px;
	}
	.grid-container {
	  margin-left: 0px;
	  display: grid;
	  grid-template-columns: 20px 20px auto;
	}
</style>
<body onload="onload()">
	<h1><i class="fas fa-list"></i>TodoApp</h1>
	<div id="select">
		
	</div>
	<input type="text" placeholder="subject here" id="text"></input>
	<button onclick="todo.add()"><i class="fas fa-plus"></i></button>
	<button onclick="todo.clear1()"><i class="fas fa-trash"></i></button>
	<div id="list">
		<li>li</li>
	</div>
</body>
<script type="text/javascript">
	var todo = new class{
		async add(){
			var value = document.getElementById('text').value
			var json = {resource:"todo",action:"add",params:{id:Date.now(),subject:value,pid:1}}
			var data = await dodispatch(json)
	  	this.list()
	  	document.getElementById('text').value = ""
		  	// document.getElementById("container").append("<button>acdkdkdkk</button")
		}
		async docheck (id,checked){
			// var value = document.getElementById('text').value
			// let checked = document.getElementById('checked').value
			var json = {resource:"todo",action:"checked",params:{id,checked}}
			var data = await dodispatch(json)
		  this.list()
		}
		async remove (id){
			var json = {resource:"todo",action:"remove",params:{id:id}}
			var data = await dodispatch(json)
			this.list()
		}
		async clear1 (){
			// alert(12)
			var json = {resource:"todo",action:"clear",params:{}}
			var data = await dodispatch(json)
			this.list()
		}	
		async list(){
			var json = {resource:"todo",action:"list",params:{}}
			var data = await dodispatch(json)
			// await dolist("list",data)
			var elementid = "list"
			var options = data
			var m = []
			for (var i = 0; i < options.length; i += 1){
				var checked = options[i].checked?"checked":""
		        m[i] = `
		            <div><i onclick="todo.remove(${options[i].id})" class="fas fa-square-minus"></i></div>
			        <div><input type="checkbox" onclick="todo.docheck(${options[i].id},this.checked)" ${checked}/></div>
			        <div>${options[i].subject}</div>
		        
		        `;
		    }
			document.getElementById(elementid).innerHTML = `<div class="grid-container id="container">`+ m.join("") +`</div>`
		}
	}()
	async function dodispatch(json){
		const response = await fetch('/api',{
			headers: {
		      'Accept': 'application/json',
		      'Content-Type': 'application/json'
		    },
		    method: "POST",
		    body: JSON.stringify(json)
		});
	  	const result = await response.json();
	  	// log(result)
	  	// return data;
	  	if(result.error)
	  		throw new Error(result.error)
	  	else
	  		return result.data
		// alert(JSON.stringify(data))
	}
	async function onload(){
		todo.list()
		var p1 = await dodispatch({resource:"project",action:"list",params:{}})
		var p2 = p1.map(x=>`<option value="${x.id}">${x.name}</option>`)
		document.getElementById("select").innerHTML = 
		`<select id="ps">${p2.join()}</select>`
	}
</script>
