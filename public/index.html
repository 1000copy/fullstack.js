<link rel="manifest" href="manifest.json" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="application-name" content="PWA Workshop" />
<meta name="apple-mobile-web-app-title" content="PWA Workshop" />
<meta name="msapplication-starturl" content="/index.html" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>
<link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.css"> 
<style>
	ul {
	list-style: none;
	}
	#list{
		margin-top:20px;
	}
	.grid-container {
	  margin-left: 0px;
	  display: grid;
	  grid-template-columns: 30px 30px auto;
	}
</style>
<body onload="onload()">
	<h1><i class="fas fa-list"></i>TodoApp</h1>
	<input type="text" placeholder="subject here" id="text"></input>
	<button onclick="add()"><i class="fas fa-plus"></i></button>
	<button onclick="clear1()"><i class="fas fa-trash"></i></button>
	<div id="list">
		<li>li</li>
	</div>
</body>
<script type="text/javascript">
	function onload(){
		// init here
		list()
	}
async function list(){
	var json = {resource:"todo",action:"list",params:{}}
	var data = await dodispatch(json)
	// await dolist("list",data)
	var elementid = "list"
	var options = data
	var m = []
	for (var i = 0; i < options.length; i += 1){
		var checked = options[i].checked?"checked":""
        m[i] = `
        <div class="grid-container">
	        <div><i onclick="remove(${options[i].id})" class="fas fa-minus"></i></div>
	        <div><input type="checkbox" onclick="docheck(${options[i].id})" ${checked}/></div>
	        <div>${options[i].subject}</div>
        </div>
        `;
    }
	document.getElementById(elementid).innerHTML =  m.join("") ;
}
function log(str){
	// console.log(str)
}
function echo1(){
	alert(1)
}
async function echo(){
	var json = {a:1}
	const response = await fetch('/echo',{
		headers: {
	      'Accept': 'application/json',
	      'Content-Type': 'application/json'
	    },
	    method: "POST",
	    body: JSON.stringify(json)
	});
  	const result = await response.json();
  	// log(result)
  	log(JSON.stringify(result.data))
}
async function dodispatch(json){
	const response = await fetch('/api',{
		headers: {
	      'Accept': 'application/json',
	      'Content-Type': 'application/json'
	    },
	    method: "POST",
	    body: JSON.stringify(json)
	});
  	const result = await response.json();
  	log(result)
  	// return data;
  	if(result.error)
  		throw new Error(result.error)
  	else
  		return result.data
	// alert(JSON.stringify(data))
}
async function add(){
	var value = document.getElementById('text').value
	var json = {resource:"todo",action:"add",params:{id:Date.now(),subject:value}}
	var data = await dodispatch(json)
  	list()
  	document.getElementById('text').value = ""
}
async function docheck(id){
	// var value = document.getElementById('text').value
	var json = {resource:"todo",action:"checked",params:{id}}
	var data = await dodispatch(json)
  	list()
}
async function remove(id){
	var json = {resource:"todo",action:"remove",params:{id:id}}
	var data = await dodispatch(json)
	list()
}
async function clear1(){
	// alert(12)
	var json = {resource:"todo",action:"clear",params:{}}
	var data = await dodispatch(json)
	list()
}
</script>
