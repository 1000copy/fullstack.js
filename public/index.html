<link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.css"> 
<style>ul {
list-style: none;
}</style>
<body onload="onload()">
	<h1><i class="fas fa-camera"></i>TodoApp</h1>
	<input type="text" placeholder="subject here" id="text"></input>
	<button onclick="add()">Add</button>
	<button onclick="echo()">Clear</button>
	<ul id="list">
		<li>li</li>
	</ul>
</body>
<script type="text/javascript">
	function onload(){
		// init here
		list()
	}
async function list(){
	var json = {resource:"todo",action:"list",params:{}}
	var data = await dodispatch(json)
	// await dolist("list",data)
	var elementid = "list"
	var options = data
	var m = []
	for (var i = 0; i < options.length; i += 1){
        m[i] = `<li><button onclick="remove(${options[i].id})">Del</button><input type="checkbox"/>${options[i].subject}</li>`;
    }
	document.getElementById(elementid).innerHTML =  m.join("") ;
}
function log(str){
	// console.log(str)
}
async function echo(){
	var json = {a:1}
	const response = await fetch('/echo',{
		headers: {
	      'Accept': 'application/json',
	      'Content-Type': 'application/json'
	    },
	    method: "POST",
	    body: JSON.stringify(json)
	});
  	const result = await response.json();
  	// log(result)
  	log(JSON.stringify(result.data))
}
async function dodispatch(json){
	const response = await fetch('/api',{
		headers: {
	      'Accept': 'application/json',
	      'Content-Type': 'application/json'
	    },
	    method: "POST",
	    body: JSON.stringify(json)
	});
  	const result = await response.json();
  	log(result)
  	// return data;
  	if(result.error)
  		throw new Error(result.error)
  	else
  		return result.data
	// alert(JSON.stringify(data))
}
async function add(){
	var value = document.getElementById('text').value
	var json = {resource:"todo",action:"add",params:{id:Date.now(),subject:value}}
	var data = await dodispatch(json)
  	list()
}
async function remove(id){
	var json = {resource:"todo",action:"remove",params:{id:id}}
	var data = dodispatch(json)
	list()
}
</script>
